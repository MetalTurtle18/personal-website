---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import ContentCard from '../../components/ContentCard.astro';

// Get all projects and sort by date (newest first)
// In production, filter out drafts
const allProjects = await getCollection('projects', ({ data }) => {
  return import.meta.env.PROD ? !data.draft : true;
});
const sortedProjects = allProjects.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<Layout title="Projects">
  <div class="projects-page">
    <header class="page-header">
      <h1>Projects</h1>
      <p class="page-description">
        A collection of projects I've worked on or am currently developing.
      </p>
    </header>

    <section class="projects-grid">
      {
        sortedProjects.map((project) => (
          <ContentCard
            title={project.data.title}
            description={project.data.description}
            pubDate={project.data.pubDate}
            chronoDate={project.data.chronoDate}
            slug={project.id}
            image={project.data.image}
            type="projects"
            draft={project.data.draft}
          />
        ))
      }
    </section>

    {
      sortedProjects.length === 0 && (
        <div class="empty-state">
          <p>No projects yet. Check back soon!</p>
        </div>
      )
    }
  </div>
</Layout>

<style>
  .projects-page {
    max-width: 1200px;
    margin: 0 auto;
    padding: 3rem 1.5rem;
  }

  .page-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .page-header h1 {
    font-size: 3rem;
    margin: 0 0 1rem 0;
    color: #000;
  }

  .page-description {
    font-size: 1.2rem;
    color: #555;
    margin: 0;
  }

  .projects-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 2rem;
  }

  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    color: #777;
  }

  @media (max-width: 768px) {
    .projects-page {
      padding: 2rem 1rem;
    }

    .page-header h1 {
      font-size: 2.5rem;
    }

    .page-description {
      font-size: 1.1rem;
    }

    .projects-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
